---
title: "I like my wines strong and bold"
subtitle: "Red Wines: A Data Exploration."
author: "Krzysztof Orlinski"
date: "20/3/2019"
output: html_document
---
```{r setup, include=FALSE}
# knitr: Suppress code/messages/warnings 
#        Set default plot options and center them
knitr::opts_chunk$set(fig.width=10,fig.height=8,fig.path='Figs/',
                      fig.align='center',tidy=TRUE,
                      echo=FALSE,warning=FALSE,message=FALSE)
```

"I like my wines strong and bold" by Krzysztof Orli≈Ñski
========================================================

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using in your analysis in this code
# chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk. This
# prevents the code from displaying in the knitted HTML output. You should set
# echo=FALSE for all code chunks in your file, unless it makes sense for your
# report to show the code that generated a particular plot.

# The other parameters for "message" and "warning" should also be set to FALSE
# for other code chunks once you have verified that each plot comes out as you
# want it to. This will clean up the flow of your report.

library(ggplot2)
# install.packages("corrplot", repos = "http://cran.us.r-project.org")
library(corrplot)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

#Load the dataset
WineCellar <- read.csv('wineQualityReds.csv')

#Remove the row index
WineCellar$X <- NULL

#Create a new variable: total.acidity - a sum of fixed, volatile acidity and citric acid
WineCellar$total.acidity <- WineCellar$fixed.acidity + WineCellar$volatile.acidity + WineCellar$citric.acid
```

I've used the data provided by the authors of an article on relating wine
quality with physicochemical properties:
P. Cortez, A. Cerdeira, F. Almeida, T. Matos and J. Reis.
Modeling wine preferences by data mining from physicochemical properties.
In Decision Support Systems, Elsevier, 47(4):547-553. ISSN: 0167-9236.

The dataset describes 11 physicochemical properties of Portugeese red
varieties of Vinho Verde - a young type of wine, usually with lower alcohol
content than usual 11-13% and slightly sparkling. Vinho Verde is often drank
as a cooling beverage in summer.

The 11 properties are:
1 - fixed acidity (tartaric acid - g / dm^3)
   2 - volatile acidity (acetic acid - g / dm^3)
   3 - citric acid (g / dm^3)
   4 - residual sugar (g / dm^3)
   5 - chlorides (sodium chloride - g / dm^3
   6 - free sulfur dioxide (mg / dm^3)
   7 - total sulfur dioxide (mg / dm^3)
   8 - density (g / cm^3)
   9 - pH
   10 - sulphates (potassium sulphate - g / dm3)
   11 - alcohol (% by volume)
   Output variable (based on sensory data): 
   12 - quality (score between 0 and 10)

 1 - fixed acidity: most acids involved with wine or fixed or nonvolatile (do
not evaporate readily)

 2 - volatile acidity: the amount of acetic acid in wine, which at too high
of levels can lead to an unpleasant, vinegar taste

 3 - citric acid: found in small quantities, citric acid can add 'freshness'
and flavor to wines

 4 - residual sugar: the amount of sugar remaining after fermentation stops,
it's rare to find wines with less than 1 gram/liter and wines with greater than
45 grams/liter are considered sweet

 5 - chlorides: the amount of salt in the wine

 6 - free sulfur dioxide: the free form of SO2 exists in equilibrium between
molecular SO2 (as a dissolved gas) and bisulfite ion; it prevents microbial
growth and the oxidation of wine

 7 - total sulfur dioxide: amount of free and bound forms of S02; in low
concentrations, SO2 is mostly undetectable in wine, but at free SO2
concentrations over 50 ppm, SO2 becomes evident in the nose and taste of wine

 8 - density: the density of water is close to that of water depending
on the percent alcohol and sugar content

 9 - pH: describes how acidic or basic a wine is on a scale from 0
(very acidic) to 14 (very basic); most wines are between 3-4 on the pH scale

 10 - sulphates: a wine additive which can contribute to sulfur dioxide gas
(S02) levels, wich acts as an antimicrobial and antioxidant

 11 - alcohol: the percent alcohol content of the wine

 Output variable (based on sensory data): 
 12 - quality (score between 0 and 10)

# Univariate Plots Section

Interesting qualities to be checked:

1. Acidity

There are 3 attributes that describe acidity:
- fixed acidity (tartaric acid)
- volatile acidity (acetic acid)
- citric acid

The first one gives a strong, slightly spicy feeling. It adds nothing
or almost nothing to the overall aroma of the wine. This cannot be said of
acetic acid and citric acid. Acetic acid is a bit irritant and heavy
but in small ammounts can add character. Citric acid is fresh and vibrant
and adds lightness.

# Fixed acidity (tartaric acid)
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Fixed acidity (tartaric acid)
summary(WineCellar$fixed.acidity)
```

# Volatile acidity (acetic acid)
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Volatile acidity (acetic acid)
summary(WineCellar$volatile.acidity)
```

# Citric acid
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Citric acid
summary(WineCellar$citric.acid)
```

It sure seems as if the tartaric acid is in "the lead of the pack".
The minimum value in the dataset is 4.60g/dm^3, whereas the maximum
value for the citric and acetic acid is less than 1.6g/dm^3.
That said, it is typical for Vinho Verde to be on the acidic side,
but... sometimes the sugar content is high enough to mask the acidity.
It will be interesting to check it out later.

2. Sweet or dry

Interestingly the wine cannot be called sweet or dry based only on the
sugar content. If the sugar content is high, but the acidity is high as well
the wine will not feel all that sweet. If we add high alcohol content,
the overall feeling will be of a semidry wine. This is because alcohol adds
bitterness that balances the sweetness.

```{r echo=FALSE, message=FALSE, warning=FALSE}

#Sugar content histogram
qplot(WineCellar$residual.sugar, geom="histogram", binwidth=0.1, main="Sugar content", xlab="Residual sugar in g/dm^3")
```

Surely most wines in the dataset contain 1-3g/dm^3 residual sugar.
This is interesting! While the histogram in this range could be considered
normal or very close to normally distributed, there are many wines with sugar
content exceeding this value and reaching 15-16g/dm^3.

```{r echo=FALSE, message=FALSE, warning=FALSE}
qplot(WineCellar$alcohol, geom="histogram", binwidth=0.5, main="Alcohol content", xlab="Alcohol content in %")
```

The alcohol content distribution is strongly right-skewed with mode around
9.5%. This is pretty low for traditional wines, but ok and expected for Vinho
Verde. What is more interesting, however are all the wines with alcohol content
exceeding 11% and seeming very close to the values met for traditional wines.
Could it be that some Vinho Verde wines are that strongly fermented?
Or maybe it's the high sugar content which makes them have high alcohol content
as well? This needs to be ispected closely.


3. Fresh wines

There is a special cathegory of Vinho Verde that come into my mind.
These are refreshing, mineral and light, excellent for hot, summer trips
by the ocean. It would be interesting to check if some cathegory will form
by plotting minerality (chlorides), citric acid and alcohol.

```{r echo=FALSE, message=FALSE, warning=FALSE}

#Chloride concentration histogram
qplot(WineCellar$chlorides,
      geom="histogram",
      binwidth=0.01,
      main="Chloride content (salt)",
      xlab="Chloride content in g/dm^3")
```

Very intriguing! The chloride histogram is very similar to the sugar content!
Although these two don't need to be very closely related a comparison of both
parameters is a must!

```{r echo=FALSE, message=FALSE, warning=FALSE}

#Wine density histogram
qplot(WineCellar$density,
      geom="histogram",
      binwidth=0.001,
      main="Wine density",
      xlab="Wine density in g/dm^3")
```

The density plot is pretty much normally distributed. Most wines have
slightly lower density than water (1 g/dm^3), which is caused by alcohol
- alcohol causes contraction of the volume in alcohol-water solutions.
That said, this means that most wines probably have high alcohol content
but low sugar content, which would highten the density.

```{r echo=FALSE, message=FALSE, warning=FALSE}

# Wine acidity (pH) histogram
qplot(WineCellar$pH,
      geom="histogram",
      binwidth=0.1,
      main="pH value", xlab="pH")
```

pH is calculated as the negative logarithm of proton concentration
and is a measure of acidity. pH = 7 is considered neutral. pH=3-3.5
which is the case of this wine dataset, means that these are usually
pretty acidic. Not necessarily sour (the acid can be screened by sugar).

# Univariate Analysis

### What is the structure of your dataset?

The data is structured in a form of a table with 13 columns and 1599 rows.

### What is/are the main feature(s) of interest in your dataset?

Alcohol, sugar and quality.

### What other features in the dataset do you think will help support your \
investigation into your feature(s) of interest?

It's the formation of multivariable plots.

### Did you create any new variables from existing variables in the dataset?

Yes - I've calculated the total acidity column, which sums the concentrations
of citric acid, acetic acid (volatile acidity) and tartaric
acid (fixed acidity).

### Of the features you investigated, were there any unusual distributions? \
Did you perform any operations on the data to tidy, adjust, or change the form \
of the data? If so, why did you do this?

There were usually two types of distributions - normal (or close to normal)
and right-skewed.

# Bivariate Plots Section

```{r echo=FALSE, message=FALSE, warning=FALSE}

# Alcohol vs. sugar scatterplot
ggplot(WineCellar, aes(x=residual.sugar, y=alcohol)) +
  geom_point(alpha=0.2)

```

Most wines fall into the cathegory of those with a low sugar content
below 4g/dm^3 and independent of the alcohol content.

```{r echo=FALSE, message=FALSE, warning=FALSE}

# Chloride concentration vs. sugar scatterplot
ggplot(WineCellar, aes(x=residual.sugar, y=chlorides)) +
  geom_point(alpha=0.1)

```

This is interesting! While most of the wines can be precisely described
as containing at most 4g/dm^3 sugar and 0.2g/dm^3 salt, there are two
distinct cathegories of wines, i.e.
- those with low salt content and high sugar content
- those with low sugar content and high salt content
There seem to be no wines that would containg simultaneously high ammounts
of sugar and chlorides!

```{r echo=FALSE, message=FALSE, warning=FALSE}

# Alcohol concentration vs. pH scatterplot
ggplot(WineCellar, aes(x=pH, y=alcohol)) +
  geom_point(alpha=0.2)

```

The plot is pretty much uniformly distributed. What is slightly visible
is the triangle like shape of the distribution. Many wines can be found
at its base but as the alcohol content increases, the pH spread decreases.

```{r echo=FALSE, message=FALSE, warning=FALSE}

# Chloride concentration vs. citric acid concentration scatterplot
ggplot(WineCellar, aes(x=citric.acid, y=chlorides)) +
  geom_point(alpha = 0.2)

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

# Alcohol concentration vs. citri cacid concentration scatterplot
ggplot(WineCellar, aes(x=citric.acid, y=alcohol)) +
  geom_point(alpha=0.2)

```

While wines may contain up to 0.75 g/dm^3 of citric acid, their chloride
content is usually restricted to 0.1-0.15g/dm^3. This cannot be said for
alcohol, for which there seem to be wines with many different combinations
of citric acid and alcohol content. The distribution is more than less uniform

```{r echo=FALSE, message=FALSE, warning=FALSE}

# pH vs. fixed acidity (tartaric acid concentration) scatterplot
ggplot(WineCellar, aes(x=fixed.acidity, y=pH)) +
  geom_point()

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

# pH vs. volatile acidity (acetic acid concentration) scatterplot
ggplot(WineCellar, aes(x=volatile.acidity, y=pH)) +
  geom_point(alpha=0.2)

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

# pH vs. citric acid concentration scatterplot
ggplot(WineCellar, aes(x=citric.acid, y=pH)) + geom_point()

```
Now this shows that it's mostly tartaric acid (fixed acidity)
and citric acid that contribute to the overall pH. There seems to be
little or no correlation between volatile acidity and pH - the points
are all groupped mostly in a closed region of 0.3-0.8 volatile acidity
and 3-3.5pH.

```{r echo=FALSE, message=FALSE, warning=FALSE}

# Compare two scatterplots pH vs. fixed acidity or vs. total acidity
# to see if acetic acid and citric acid make a visible difference.
require(gridExtra)
plot1 <- ggplot(WineCellar, aes(x=total.acidity, y=pH)) + geom_point()
plot2 <- ggplot(WineCellar, aes(x=fixed.acidity, y=pH)) + geom_point()
grid.arrange(plot1, plot2, ncol=2)

```

Unfortunately the pH vs. acidity plot has not changed much with total acidity
included. This is probably because the citric and acetic acid content is too
low to make any significant difference.


It will be more insightful to look into a correlation matrix

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=8}

# Prepare a correlation matrix to see any hidden correlations
h <- cor(WineCellar)
corrplot(h, addCoef.col = "black")
```


# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the \
investigation. How did the feature(s) of interest vary with other features in \
the dataset?

I've found that most red Vinho Verde wines contain 1-3g/dm^3 of sugar
but can have 8-14% of alcohol. This difference was intriguing. Secondly,
the Chloride content is pretty well determined for most wines in the dataset.
Similarly to the sugar content, the chloride is usually present in a narrow
range of 0.05-0.1g/dm^3. For unusual types, there were some wines with high
chloride content but low sugar content and vice versa. There were no wines
with simultaneously high sugar AND chloride content.

Considering pH and alcohol content, when the alcohol content is low the pH
can vary from 3-3.5, but as the alcohol content increases, the pH narrows
 and gets closer to 3.4.
 
Considering alcohol and chloride concentration with respect to the citric
acid, the chloride concentration has a small range 0.05-0.1g/dm^3 for acid
concentrations of 0-0.75g/dm^3. In the case of alcohol the distribution
is roughly uniform with many wines exhibiting a fixed citric acid concentration
of 0, 0.25 or 0.5g/dm^3.

Finally, tartaric acid (fixed acidity) concentration could have a major impact
on the overall pH of the wine as the correlation is pretty good, though not
linear. The acetic acid (volatile acidity) and citric acid also show some
correlation with the pH, but when added to the fixed acidity and plotted against
pH, do not show visible difference when compared with the tartaric acid vs. pH
plot.

### Did you observe any interesting relationships between the other features \
(not the main feature(s) of interest)?

The quality of the wine is correlated with the volatile acidity and negatively
correlated with alcohol concentration. The relationship between fixed acidity
and citric acid is interesting too (strongly negative). It could suggest that
during wine preparation, one can increase certain type of acidity simultaneously
lowering the other. Moreover, the density is negatively correlated with fixed
acidity, citric acid and residual sugar, and positively correlated with alcohol concentration.

### What was the strongest relationship you found?

It was that of a tartaric acid (fixed acidity) versus pH.

# Multivariate Plots Section

```{r echo=FALSE, message=FALSE, warning=FALSE}

# Prepare a scatterplot of alcohol concentration vs. volatile acidity
# with point coloring dependent on the wine quality.
ggplot(WineCellar,aes(x=volatile.acidity,y=alcohol,color=as.factor(quality))) +
  geom_point(alpha=0.5) +
  scale_color_brewer(palette = "RdYlBu", name="Quality", direction=-1)
```

It shows that better quality wines tend to have lower volatile
acidity and higher alcohol concentration.

```{r echo=FALSE, message=FALSE, warning=FALSE}

# Prepare a scatterplot of alcohol concentration vs. fixed acidity
# with point coloring denepdent on the wine density.
ggplot(WineCellar,aes(x=fixed.acidity,y=alcohol,color=density)) +
  geom_point(alpha=0.7)
```
It was evident from the correlation matrix that density was well correlated
with fixed acidity and alcohol. The graph shows that wines with lower fixed
acidity tend to have a lower density, especially when alcohol concentration
is higher. One effect responsible for this is contraction of a alcohol-water
solution.

```{r echo=FALSE, message=FALSE, warning=FALSE}

# Prepare a scatterpot of pH vs. fixed acidity with point coloring dependent
# on the wine quality.
ggplot(WineCellar,aes(x=fixed.acidity,y=pH,color=as.factor(quality))) +
  geom_point(alpha=0.7) +
  scale_color_brewer(palette = "RdYlBu", name="Quality", direction=-1)
```

There is no evident relationship between pH and fixed acidity that would hold
for wines with high or low quality. The points are evenly distributed,
with some exceptions - wines with low fixed acidity and high pH tend to have
a higher quality score.


```{r echo=FALSE, message=FALSE, warning=FALSE}

# A scatterplot of alcohol concentration vs. citric acid concentration
# with point color dependent on the wine quality.
ggplot(WineCellar, aes(x=citric.acid, y=alcohol, color=as.factor(quality))) +
  geom_point(alpha=0.7) +
  scale_color_brewer(palette = "RdYlBu", name="Quality", direction=-1)

```

It looks like higher quality wines tend to have more than 10% of alcohol
and citric acid concentration around 0.5. Poor quality wines, rated around 3-4
have usually low alcohol and low citric acid concentrations, below 10 and ca. 0,
respectively.

```{r echo=FALSE, message=FALSE, warning=FALSE}

# A scatterplot of wine density vs. chloride concentration with point coloring
# dependent on the alcohol concentration.
ggplot(WineCellar,aes(x=chlorides,y=density,color=alcohol)) +
  geom_point(alpha=0.3)+scale_x_continuous(trans="log2") +
  scale_color_gradient2("Alcohol", low='green', high='red', midpoint = median(WineCellar$alcohol)) +
  theme(panel.grid.minor = element_blank(), 
        panel.background = element_rect(fill = "darkgrey"))
```

A last, and unexpected relationship is that of density, chloride concentration
and alcohol. Wines with lower density and low chloride concentration tend to
have higher alcohol content. A vast majority of wines with alcohol content as
low as 10% has a density in the range 0.995-1.000 and chloride concentration in
the range 0.05-0.1g/dm^3. There are about 50 outliers with alcohol content
usually close to 10% and high chloride concentrations of 0.2-0.6g/dm^3.

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the \
investigation. Were there features that strengthened each other in terms of \
looking at your feature(s) of interest?

It was difficult to find some evident trend that would arise from difference
in terms of the 3rd parameter. The last plot, i.e. density vs. chlorides
with respect to the alcohol content were the most evident. Clearly,
the lower the alcohol content, the lower the density and the chloride
content was.


### Were there any interesting or surprising interactions between features?

A surprising interaction was that of wine density, chloride concentration
and alcohol content. I did expect some relationship between density and alcohol
but the fact that it held still againt chloride concentration was a surprise.

------

# Final Plots and Summary

### Plot One
```{r echo=FALSE, message=FALSE, warning=FALSE}

# Alcohol concentration histogram
qplot(WineCellar$alcohol,
      geom="histogram",
      binwidth=0.3,
      main="Alcohol content",
      xlab="Alcohol content in %",
      ylab="Count [a.u.]", fill=I("blue"))
```

### Description One

The alcohol concentration in the red wine population shows a maximum near 9.5%.
Though this is the most popular value, it is evident that there are even more
types of wines with higher alcohol content (>10%). Very rare ones contain less
than 9% or more than 14%.

### Plot Two
```{r echo=FALSE, message=FALSE, warning=FALSE}

# Chloride concentration vs. sugar concentration - scatterplot
ggplot(WineCellar, aes(x=residual.sugar, y=chlorides), color='green') + geom_point(shape=21, alpha=0.5, color="green", fill="black") +
  labs(title="Chloride vs. sugar concentration in red Vinho Verde wines",
       x="Residual sugar [g/dm^3]", y="Chlorides [g/dm^3]") + theme_classic()

```

### Description Two

Chloride and sugar concentrations in red Vinho Verde wines tend to hold
certain standards, i.e. the sugar usually does not exceed 3g/dm^3,
while chlorides do not exceed 0.1g/dm^3. What's interesting, however,
is that there don't seem to be many wines with simultaneously increased
both concentrations. Usually if one is significantly above the mean,
e.g. sugar  8g/dm^3, the chloride concetration stays low, below 0.2g/dm^3.
One can see only that only one wine shows high sugar concentration (ca 7g/dm^3)
and a chloride concentration of 0.2g/dm^3.

### Plot Three
```{r echo=FALSE, message=FALSE, warning=FALSE}

# Pseudo heat map.
# A scatterplot of wine density vs chloride concentration with point color
# dependent on the alcohol concentration. Use log scale on x to stretch
# the data a little bit.
ggplot(WineCellar,aes(x=chlorides,y=density,color=alcohol)) +
  geom_point(alpha=0.7) + scale_x_continuous(trans="log2") +
  theme_light() +
  labs(title="Density, chloride and alcohol concentration in red Vinho
       Verde wines", x="Chloride concentration [g/dm^3]",
       y="Wines density [g/cm^3]") +
  scale_color_gradient2("Alcohol", low='green', high='red', midpoint = median(WineCellar$alcohol)) +
  theme(panel.grid.minor = element_blank(), 
        panel.background = element_rect(fill = "darkgrey"))
```

### Description Three

If the alcohol concentration is high (13-14%), more often than not the density
will be low, at around 0.99g/cm^3. The chloride concentration is pretty much
fixed, although some correlation is evident in the semi-log graph above (log
scale: chloride). High chloride wines tend to have less alcohol (<10%).

------

# Reflection


The red wines data set contains some information on chemical composition
of 1600 red Vinho Verde wines from Portugal.

The population is high enough to see some correlation in the data or at
the very least see an indication of it, but is some cases it seemed insufficient
to determine whether the data is evenly distributed in the specific range or
were some values dominating. That was the case of the the alcohol vs. citric
acid.

The nice correlation between tartaric acid (fixed acidity) and pH was pleasent
to look at, though the connection was to be expected.

A surprise and perhaps a note for future analyses is to look more into
connections between organic and inorganic elements of the wine. Many interesting
results had some connection with the chloride content (e.g. sugar or alcohol).